# **[netfilter hooks](https://wiki.nftables.org/wiki-nftables/index.php/Netfilter_hooks)**

nftables uses mostly the same Netfilter infrastructure as legacy iptables. The hook infrastructure, Connection Tracking System, NAT engine, logging infrastructure, and userspace queueing remain the same. Only the packet classification framework is new.

## Netfilter hooks into Linux networking packet flows

The following schematic shows packet flows through Linux networking:

![](https://people.netfilter.org/pablo/nf-hooks.png)

Traffic flowing to the local machine in the input path sees the prerouting and input hooks. Then, the traffic that is generated by local processes follows the output and postrouting path.

If you configure your Linux box to behave as a router, do not forget to enable forwarding via:

```bash
echo 1 > /proc/sys/net/ipv4/ip_forward
```

Then packets that are not addressed to your local system will be seen from the forward hook. Such forwarded packets follow the path: prerouting, forward and postrouting.

In a major change from iptables, which predefines chains at every hook (i.e. INPUT chain in filter table), nftables predefines no chains at all. You must must explicitly create a base chain at each hook at which you want to filter traffic.

## Ingress hook

The ingress hook was added in Linux kernel 4.2. Unlike the other netfilter hooks, the ingress hook is attached to a particular network interface.

You can use nftables with the ingress hook to enforce very early filtering policies that take effect even before prerouting. Do note that at this very early stage, fragmented datagrams have not yet been reassembled. So, for example, matching ip saddr and daddr works for all ip packets, but matching L4 headers like udp dport works only for unfragmented packets, or the first fragment.

The ingress hook provides an alternative to tc ingress filtering. You still need tc for traffic shaping/queue management.

## Hooks by family and chain type

The following table lists available hooks by family and chain type. Minimum nftables and Linux kernel versions are shown for recently-added hooks.

|               |     Hooks    |            |         |       |        |             |              |
|---------------|:------------:|:----------:|:-------:|:-----:|:------:|:-----------:|:------------:|
| Chain type    |    ingress   | prerouting | forward | input | output | postrouting |    egress    |
|  inet family  |              |            |         |       |        |             |              |
| filter        | 0.9.7 / 5.10 |     Yes    |   Yes   |  Yes  |   Yes  |     Yes     |      No      |
| nat           |      No      |     Yes    |    No   |  Yes  |   Yes  |     Yes     |      No      |
| route         |      No      |     No     |    No   |   No  |   Yes  |      No     |      No      |
|   ip6 family  |              |            |         |       |        |             |              |
| filter        |      No      |     Yes    |   Yes   |  Yes  |   Yes  |     Yes     |      No      |
| nat           |      No      |     Yes    |    No   |  Yes  |   Yes  |     Yes     |      No      |
| route         |      No      |     No     |    No   |   No  |   Yes  |      No     |      No      |
|   ip family   |              |            |         |       |        |             |              |
| filter        |      No      |     Yes    |   Yes   |  Yes  |   Yes  |     Yes     |      No      |
| nat           |      No      |     Yes    |    No   |  Yes  |   Yes  |     Yes     |      No      |
| route         |      No      |     No     |    No   |   No  |   Yes  |      No     |      No      |
|   arp family  |              |            |         |       |        |             |              |
| filter        |      No      |     No     |    No   |  Yes  |   Yes  |      No     |      No      |
| nat           |      No      |     No     |    No   |   No  |   No   |      No     |      No      |
| route         |      No      |     No     |    No   |   No  |   No   |      No     |      No      |
| bridge family |              |            |         |       |        |             |              |
| filter        |      No      |     Yes    |   Yes   |  Yes  |   Yes  |     Yes     |      No      |
| nat           |      No      |     No     |    No   |   No  |   No   |      No     |      No      |
| route         |      No      |     No     |    No   |   No  |   No   |      No     |      No      |
| netdev family |              |            |         |       |        |             |              |
| filter        |   0.6 / 4.2  |     No     |    No   |   No  |   No   |      No     | 1.0.1 / 5.16 |
| nat           |      No      |     No     |    No   |   No  |   No   |      No     |      No      |
| route         |      No      |     No     |    No   |   No  |   No   |      No     |      No      |
