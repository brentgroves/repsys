# **[Netfilter Hooks](https://wiki.nftables.org/wiki-nftables/index.php/Netfilter_hooks)**


**[Back to Research List](../../../../../research_list.md)**\
**[Back to Current Status](../../../../../../development/status/weekly/current_status.md)**\
**[Back to Main](../../../../../../README.md)**

## references

- **[Netfilter hook](https://wiki.nftables.org/wiki-nftables/index.php/Netfilter_hooks)**
- **[Netfilter and iptables homepage](http://www.netfilter.org/)**

nftables uses mostly the same Netfilter infrastructure as legacy iptables. The hook infrastructure, **[Connection Tracking System](http://people.netfilter.org/pablo/docs/login.pdf)**, NAT engine, logging infrastructure, and userspace queueing remain the same. Only the packet classification framework is new.

## Netfilter hooks into Linux networking packet flows
The following schematic shows packet flows through Linux networking:

![pf](https://people.netfilter.org/pablo/nf-hooks.png)

Traffic flowing to the local machine in the input path sees the prerouting and input hooks. Then, the traffic that is generated by local processes follows the output and postrouting path.

If you configure your Linux box to behave as a router, do not forget to enable forwarding via:

```bash
echo 1 > /proc/sys/net/ipv4/ip_forward
cat /proc/sys/net/ipv4/ip_forward
1
```

## Ingress hook

The ingress hook was added in Linux kernel 4.2. Unlike the other netfilter hooks, the ingress hook is attached to a particular network interface.

You can use nftables with the ingress hook to enforce very early filtering policies that take effect even before prerouting. Do note that at this very early stage, fragmented datagrams have not yet been reassembled. So, for example, matching ip saddr and daddr works for all ip packets, but matching L4 headers like udp dport works only for unfragmented packets, or the first fragment.

The ingress hook provides an alternative to tc ingress filtering. You still need tc for traffic shaping/queue management.

