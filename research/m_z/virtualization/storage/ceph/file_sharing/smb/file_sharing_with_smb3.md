# **[Overview of file sharing using the SMB 3 protocol in Windows Server](https://learn.microsoft.com/en-us/windows-server/storage/file-server/file-server-smb-overview)

This article provides an overview of the Server Message Block (SMB) 3 protocol in Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, and Windows Server 2012. It covers practical applications, new and updated features compared to previous versions, and hardware requirements. Additionally, SMB serves as a fabric protocol for software-defined data center (SDDC) solutions like Storage Spaces Direct and Storage Replica. SMB 3.0 enhancements continue in subsequent releases.

Feature description
The SMB protocol is a network file sharing protocol that allows applications on a computer to read and write to files. SMB also requests services from server programs in a computer network. The SMB protocol can be used on top of its TCP/IP protocol or other network protocols. Using the SMB protocol, an application (or the user of an application) can access files or other resources at a remote server. This protocol allows applications to read, create, and update files on the remote server. SMB can also communicate with any server program that is set up to receive an SMB client request. SMB is a fabric protocol that is used by Software-defined Data Center (SDDC) computing technologies, such as Storage Spaces Direct, Storage Replica. For more information, see Windows Server software-defined datacenter.

## Practical applications

This section discusses some new practical ways to use the new SMB 3.0 protocol.

**File storage for virtualization (Hyper-V™ over SMB)**. Hyper-V can store virtual machine files, such as configuration, Virtual hard disk (VHD) files, and snapshots, in file shares over the SMB 3.0 protocol. This can be used for both stand-alone file servers and clustered file servers that use Hyper-V together with shared file storage for the cluster.
**Microsoft SQL Server over SMB**. SQL Server can store user database files on SMB file shares. Currently, SQL Server over SMB is supported with SQL Server 2008 R2 for stand-alone SQL servers. Upcoming versions of SQL Server add support for clustered SQL servers and system databases.
**Traditional storage for end-user data**. The SMB 3.0 protocol provides enhancements to the Information Worker (or client) workloads. These enhancements include reducing the application latencies experienced by branch office users when accessing data over wide area networks (WAN) and protecting data from eavesdropping attacks.

Note

If you need to conserve storage space on an SMB file share, consider using Azure File Sync with cloud tiering enabled. Azure File Sync allows you to cache your most frequently accessed files locally and tier your least frequently accessed files to the cloud, saving local storage space while maintaining performance. For details, see **[Planning for an Azure File Sync deployment](https://learn.microsoft.com/en-us/azure/storage/files/storage-sync-files-planning)**.

New and changed functionality
The following sections describe functionality that was added in SMB 3 and subsequent updates.

Features added in Windows Server 2019 and Windows 10, version 1809

| Feature/functionality                                                                      | New or updated | Summary                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|--------------------------------------------------------------------------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Ability to require write-through to disk on file shares that aren't continuously available | New            | To provide some added assurance that writes to a file share make it all the way through the software and hardware stack to the physical disk before the write operation returning as completed, you can enable write-through on the file share using either the NET USE /WRITETHROUGH command or the New-SMBMapping -UseWriteThrough PowerShell cmdlet. There's some amount of performance hit to using write-through; see the blog post Controlling write-through behaviors in SMB for further discussion. |

| Feature/functionality                   | New or updated | Summary                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|-----------------------------------------|----------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Guest access to file shares is disabled | New            | The SMB client no longer allows the following actions: Guest account access to a remote server; Fallback to the Guest account after invalid credentials are provided. For details, see Guest access in SMB2 disabled by default in Windows.                                                                                                                                                                                                                                                                                                                     |
| SMB global mapping                      | New            | Maps a remote SMB share to a drive letter that is accessible to all users on the local host, including containers. SMB global mapping is required to enable container I/O on the data volume to traverse the remote mount point. When using SMB global mapping for containers, all users on the container host can access the remote share. Any application running on the container host also have access to the mapped remote share. For details, see Container Storage Support with Cluster Shared Volumes (CSV), Storage Spaces Direct, SMB Global Mapping. |
| SMB dialect control                     | New            | You can now set registry values to control the minimum SMB version (dialect) and maximum SMB version used. For details, see Controlling SMB Dialects.                                                                                                                                                                                                                                                                                                                                                                                                           |
| Feature/functionality                                      | New or updated | Summary                                                                                                                                                                                                                                                                                         |
|------------------------------------------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| SMB Encryption                                             | Updated        | SMB 3.1.1 encryption with Advanced Encryption Standard-Galois/Counter Mode (AES-GCM) is faster than SMB Signing or previous SMB encryption using AES-CCM.                                                                                                                                       |
| Directory Caching                                          | New            | SMB 3.1.1 includes enhancements to directory caching. Windows clients can now cache larger directories, approximately 500,000 entries. Windows clients attempt directory queries with 1 MB buffers to reduce round trips and improve performance.                                               |
| Pre-Authentication Integrity                               | New            | In SMB 3.1.1, preauthentication integrity provides improved protection from a man-in-the-middle attacker tampering with SMB’s connection establishment and authentication messages. For details, see SMB 3.1.1 Pre-authentication integrity in Windows 10.                                      |
| SMB Encryption Improvements                                | New            | SMB 3.1.1 offers a mechanism to negotiate the crypto algorithm per connection, with options for AES-128-CCM and AES-128-GCM. AES-128-GCM is the default for new Windows versions, while older versions continue to use AES-128-CCM.                                                             |
| Rolling cluster upgrade support                            | New            | Enables rolling cluster upgrades by letting SMB appear to support different max versions of SMB for clusters in the process of being upgraded. For more information on letting SMB communicate using different versions (dialects) of the protocol, see the blog post Controlling SMB Dialects. |
| SMB Direct client support in Windows 10                    | New            | Windows 10 Enterprise, Windows 10 Education, and Windows 10 Pro for Workstations now include SMB Direct client support.                                                                                                                                                                         |
| Native support for FileNormalizedNameInformation API calls | New            | Adds native support for querying the normalized name of a file. For details, see FileNormalizedNameInformation.                                                                                                                                                                                 |
