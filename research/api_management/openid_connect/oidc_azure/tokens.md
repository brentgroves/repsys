# tutorial
https://www.youtube.com/watch?v=qTsqpYz5cGE
# test
https://developer.microsoft.com/
main account: brentgroves@1hkt5t.onmicrosoft.com
AlexW@1hkt5t.onmicrosoft.com
EAxejwisiakJip3
# test with postman

# register the app 
https://learn.microsoft.com/en-us/azure/databricks/dev-tools/api/latest/aad/app-aad-token
Get Azure AD tokens for users by using MSAL
name: AzureTokenTest
Client Id: 29fa39d4-de57-4009-a46a-c561fa048562
Tenant Id: 5269b021-533e-4702-b9d9-72acbc852c97

# Get the authorization code 
http://localhost:3030/auth
https://login.microsoftonline.com/<tenant-id>/oauth2/v2.0/authorize?client_id=29fa39d4-de57-4009-a46a-c561fa048562
&response_type=code
&redirect_uri=http%3A%2F%2Flocalhost
&response_mode=query
&scope=api%3A%2F%2F29fa39d4-de57-4009-a46a-c561fa048562%2FUser.Info
&state=12345

feathers redirect: http://localhost:3030/oauth/microsoft/callback
encoded: http%3A%2F%2Flocalhost%3A3030%2Foauth%2Fmicrosoft%2Fcallback

feathers redirect: http://localhost:3030/auth-callback
encoded: http%3A%2F%2Flocalhost%3A3030%2Fauth-callback
remove new line:
enter into browser:
https://login.microsoftonline.com/5269b021-533e-4702-b9d9-72acbc852c97/oauth2/v2.0/authorize?client_id=29fa39d4-de57-4009-a46a-c561fa048562&response_type=code&redirect_uri=http%3A%2F%2Flocalhost&response_mode=query&scope=api%3A%2F%2F29fa39d4-de57-4009-a46a-c561fa048562%2FUser.Info&state=12345
Feathers link:
https://login.microsoftonline.com/5269b021-533e-4702-b9d9-72acbc852c97/oauth2/v2.0/authorize?client_id=29fa39d4-de57-4009-a46a-c561fa048562&response_type=code&redirect_uri=http%3A%2F%2Flocalhost%3A3030%2Fauth-callback&response_mode=query&scope=api%3A%2F%2F29fa39d4-de57-4009-a46a-c561fa048562%2FUser.Info&state=12345

https://docs.feathersjs.com/api/authentication/service.html#to-authenticate-an-external-request

response:
http://localhost/?code=0.AXwAIbBpUj5TAke52XKsvIUsl9Q5-ilX3glApGrFYfoEhWK7ALI.AgABAAIAAAD--DLA3VO7QrddgJg7WevrAgDs_wQA9P_a884OyM1n6v6dBs-MyuQ8fJMA_1M93MK1jaP7Tzba7oW2awgAR8nihF9F9THdnM5DfxBH7sbb7VsNC6i8jqv_Ih9F8p0QwM_8lQi_n2CWAo4CE9fK4DJA7sDS3Lz6SIPU_lgkK0RU_EwZopT_0YGzE3GSW-RJPBb34RhqL3EDnxpjcuBE_9Vsu1TEUOIxDrdcHpsnUhv4AeBotcQEYRdRTetboKQ6spfIpOCIuTr1q9rxRDbTlT0mtrnYm9BuPJSEf03MbxPRPi5_vCS0hzNByxjogJ_ZKow-B10SClqBEQX6eZJgpNFbkd_yxzaOtUZ286iSBUUATlYSbF6wKXEuJBdPYzOKqnOB9gnVTtHjlTmkgtx8sNehj1nCB1kNNOlKpXdWcsT2TX9b_HA68so2NPuK5ygpKF-Eg3n6o_l7zS0jKb1who_buBj_ZGib87Awg-jtqyftmGncDmanIHLI4EZ3iWQ1q0HgwpuFE360_XMLcVAkQJKP1_PespqtuSgp7sa-b88uZ7qjxgWdEy12ZNvJhWv2o0zB5Skov8-K3Bw1OCCEfgoSy2Prir2sk4VdM1qox3McuTwL-oroBJtImYQIJhm7sLfiPQ6GnTNoTWQ29KPE_ENonIidJRUdVolQsHTeflwIjcg&state=12345&session_state=8d42ca10-57de-407c-a78b-7e72db384a26




feathers response:
http://localhost:3030/auth-callback?code=0.AXwAIbBpUj5TAke52XKsvIUsl9Q5-ilX3glApGrFYfoEhWK7ALI.AgABAAIAAAD--DLA3VO7QrddgJg7WevrAgDs_wQA9P_cjPRjA56Absz6pY8g8N5ijFf98jS6vpCJLOjuHlrh-JALgkmYeNw_1-9Jz1CtTu10Rxa9pDrnZVZ6Wo4VysnpxczYSo8lJk-muDMJWIeu4f8P2Whq2p48_4YeZy4D7_olFIlz3wE67U3r3ORy8uUN1ecOocP8x0Cm0jC9l9AuYBWH-gYArGe1Mjppb0ZAEikogIFB6LHEq7dHM4bLqDubri4mMHN9g_8RRFCSEcpYPH7ZJYrfU_u7uwhsOWN8xy4q9XslLZ1pYg7xJ3R1HrceQfN-i9ropnH4sGHwpTp-GeYzhgwXBGjag1KEptxDOFo0BsnCf3ZOLztUl9swqtWfcHVtsGOeWm94k14wRpFWC4vSxWQHp0Wgp6899qTltIy8_fwGuHelObWEXfnk9qRamldNeFCh0rKsrqdOCgYML1qU0JW0ketVv_aSkr2hMLdmLsHJoEKUZamipehs55YuO2roSH8O8H9fD0pdkFJeXXZh88-e9BKqZkv5cEjdtKxAdPDi6jZrGTbZpnM6OQTSq-LjbpgxfRSCv73iWvtmIh2apuYPTihLyH48Ofjik3Qk0WD_RSgTMXpeLcsdqNdk30uyTy7-vSDhZJGVd8_6CMlAAJsqD-dQR9LR6DfjSmjHmRayJBrYAmgggfhz_aNQLRpVqoN8oBVt_uM&state=12345&session_state=8d42ca10-57de-407c-a78b-7e72db384a26

0.AXwAIbBpUj5TAke52XKsvIUsl9Q5-ilX3glApGrFYfoEhWK7ALI.AgABAAIAAAD--DLA3VO7QrddgJg7WevrAgDs_wQA9P-UPKVvyF5CumLgvZFmQT9SamWgAB9OuFHJx9c0M-Mx3ldjecMTCk9Go3Uy2cwjJsbgx3mTdavI0jtBA5vUFMtL-snoXElyeQ7THkqohmXoFeG0k0Tc6toHAzvTY-wr_J6jXA2jgH4IaDOnFpASVOyJi8R13Qm3iCZ6emFEMm1w5q7MqZkRmNdZwXiMcY4a9vqgmFdveVrJeNQWrzWGS3ypSZfwuRP03mmkfQnQx46fgHSbW3kG8V5F4MPmwfEv94xwyXknhzzEczLnlGG4h5vvv9O8MM_pe6UOHVybOw8ySKVq9jeF-jlaMLZPKMh6welXk4gKz_sjuEbPRb-_rxNC5gWeM_m_D65NoRCQKqngYmSn9GCmurLNw3O2oQ_vt_XCR5kP8ffozot8tnd0f03a7_QNw_7fz6yIG_gXiLQwod88AZlHiwxB_CPeFU8t2qCxaXFuk3H7wDQU3ZblPocCb_2mt1OGzUI4oLx9VJ3M4SGFoEnpjnvjepq2lJPEdeAgOddhdLHFnAVyWqOYXqqUcB_XsYf73pcH6j1Sg91UvN4lzdCpRHpim7PqTRiMW_mZRvfs7x2yKaHOJWgoMKmkL7y-Be3p-79k8PrTBQJykaGb18zR3KYlz30OcTSacWcgvbV1dMzg5QWg-yanPm9A9hdOOig0rKyWwMM
0.AXwAIbBpUj5TAke52XKsvIUsl9Q5-ilX3glApGrFYfoEhWK7ALI.AgABAAIAAAD--DLA3VO7QrddgJg7WevrAgDs_wQA9P_prSE10PryP15QMzTthpl1zu0IF9cb0W7FGTM42Z7E26jAG3BLAhZh-LQ9-kpAw7BYlU4tkXvI45ceMH4YyzzsNRrBNl5CKSFNgFOLWvpJKN32Wi3JwSxg46p0xqIOoB7mKJyPpHeet0VJgM9GbytYH-Ef1avls2aT14k65UtKxwEpqSC8pIxmDRP1FCgU43GHB68ki0YT6uFEXeoViqEoWn3q4UC19dmyoxUpZBws4yxdHYLIYQzmRWNdivaS3sg4xBb12We2mJa386N3Mgh1C0b-OTtAA_VDvbXlXffHBvDrix24s_pkm9PkIzO15Fg8UcDMPxpwiT4zTQgSt_GyQFyNRPhNTc6oL9i6tTBm25fDjwUsTAmrPOg3Yh_gnaDUb_qbd4YGtn2auuV-MP9jRJu7RjsuPjX4a3lEHg5-UVi4jrPq8eJ1go5oiG5fMZQXpKalxoiGKwhdFfA4tnZ1CemXzzCTk_iNXFYpwVG31xp6zYHn1bACIDO1Hz2Bi5AW2DL0_AZIjs-zO0_2BzzIgp73IdXjwqbmSRquXFskpMEVWidQFuRyOI-tB429LC2vzUUTSzJAwsTSDc_ObNCvsyrm9L-p1dHlaNuj2OBX5Chw6UFjGKh1U1w1NzKvSrDAuYcY40GUSZ3nPvXy7YECyyeVr_i6JdBnR6MCDiUzz9WZeaVXrA&state=12345&session_state=8d42ca10-57de-407c-a78b-7e72db384a26

authorization code is in the code field in the returned URL
<!-- https://learn.microsoft.com/en-us/rest/api/servicebus/get-azure-active-directory-token -->
https://login.microsoftonline.com/5269b021-533e-4702-b9d9-72acbc852c97/oauth2/token
Use the authorization code along with curl to get the Azure AD access token

browser method:
curl -X POST -H 'Content-Type: application/x-www-form-urlencoded' \
https://login.microsoftonline.com/5269b021-533e-4702-b9d9-72acbc852c97/oauth2/v2.0/token \
-d 'client_id=29fa39d4-de57-4009-a46a-c561fa048562' \
-d 'scope=api%3A%2F%2F29fa39d4-de57-4009-a46a-c561fa048562%2FUser.Info' \
-d 'code=0.AXwAIbBpUj5TAke52XKsvIUsl9Q5-ilX3glApGrFYfoEhWK7ALI.AgABAAIAAAD--DLA3VO7QrddgJg7WevrAgDs_wQA9P_a884OyM1n6v6dBs-MyuQ8fJMA_1M93MK1jaP7Tzba7oW2awgAR8nihF9F9THdnM5DfxBH7sbb7VsNC6i8jqv_Ih9F8p0QwM_8lQi_n2CWAo4CE9fK4DJA7sDS3Lz6SIPU_lgkK0RU_EwZopT_0YGzE3GSW-RJPBb34RhqL3EDnxpjcuBE_9Vsu1TEUOIxDrdcHpsnUhv4AeBotcQEYRdRTetboKQ6spfIpOCIuTr1q9rxRDbTlT0mtrnYm9BuPJSEf03MbxPRPi5_vCS0hzNByxjogJ_ZKow-B10SClqBEQX6eZJgpNFbkd_yxzaOtUZ286iSBUUATlYSbF6wKXEuJBdPYzOKqnOB9gnVTtHjlTmkgtx8sNehj1nCB1kNNOlKpXdWcsT2TX9b_HA68so2NPuK5ygpKF-Eg3n6o_l7zS0jKb1who_buBj_ZGib87Awg-jtqyftmGncDmanIHLI4EZ3iWQ1q0HgwpuFE360_XMLcVAkQJKP1_PespqtuSgp7sa-b88uZ7qjxgWdEy12ZNvJhWv2o0zB5Skov8-K3Bw1OCCEfgoSy2Prir2sk4VdM1qox3McuTwL-oroBJtImYQIJhm7sLfiPQ6GnTNoTWQ29KPE_ENonIidJRUdVolQsHTeflwIjcg&state=12345&session_state=87a1a296-b455-4aaf-b51d-fd0c0150ee05' \
-d 'redirect_uri=http%3A%2F%2Flocalhost' \
-d 'grant_type=authorization_code' \
-d 'state=12345'


feathers method:
curl -X POST -H 'Content-Type: application/x-www-form-urlencoded' \
https://login.microsoftonline.com/5269b021-533e-4702-b9d9-72acbc852c97/oauth2/v2.0/token \
-d 'client_id=29fa39d4-de57-4009-a46a-c561fa048562' \
-d 'scope=api%3A%2F%2F29fa39d4-de57-4009-a46a-c561fa048562%2FUser.Info' \
-d 'code=0.AXwAIbBpUj5TAke52XKsvIUsl9Q5-ilX3glApGrFYfoEhWK7ALI.AgABAAIAAAD--DLA3VO7QrddgJg7WevrAgDs_wQA9P_cjPRjA56Absz6pY8g8N5ijFf98jS6vpCJLOjuHlrh-JALgkmYeNw_1-9Jz1CtTu10Rxa9pDrnZVZ6Wo4VysnpxczYSo8lJk-muDMJWIeu4f8P2Whq2p48_4YeZy4D7_olFIlz3wE67U3r3ORy8uUN1ecOocP8x0Cm0jC9l9AuYBWH-gYArGe1Mjppb0ZAEikogIFB6LHEq7dHM4bLqDubri4mMHN9g_8RRFCSEcpYPH7ZJYrfU_u7uwhsOWN8xy4q9XslLZ1pYg7xJ3R1HrceQfN-i9ropnH4sGHwpTp-GeYzhgwXBGjag1KEptxDOFo0BsnCf3ZOLztUl9swqtWfcHVtsGOeWm94k14wRpFWC4vSxWQHp0Wgp6899qTltIy8_fwGuHelObWEXfnk9qRamldNeFCh0rKsrqdOCgYML1qU0JW0ketVv_aSkr2hMLdmLsHJoEKUZamipehs55YuO2roSH8O8H9fD0pdkFJeXXZh88-e9BKqZkv5cEjdtKxAdPDi6jZrGTbZpnM6OQTSq-LjbpgxfRSCv73iWvtmIh2apuYPTihLyH48Ofjik3Qk0WD_RSgTMXpeLcsdqNdk30uyTy7-vSDhZJGVd8_6CMlAAJsqD-dQR9LR6DfjSmjHmRayJBrYAmgggfhz_aNQLRpVqoN8oBVt_uM&state=12345&session_state=87a1a296-b455-4aaf-b51d-fd0c0150ee05' \
-d 'redirect_uri=http%3A%2F%2Flocalhost%3A3030%2Fauth-callback' \
-d 'grant_type=authorization_code' \
-d 'state=12345'

http://localhost:3030/oauth/connect/microsoft/callback?


The Azure AD token is in the access_token value within the result of the call. Be sure to check that the state value matches the one that you provided earlier in this procedure.

response:
{"token_type":"Bearer","scope":"api://29fa39d4-de57-4009-a46a-c561fa048562/User.Info","expires_in":4074,"ext_expires_in":4074,"access_token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IjJaUXBKM1VwYmpBWVhZR2FYRUpsOGxWMFRPSSIsImtpZCI6IjJaUXBKM1VwYmpBWVhZR2FYRUpsOGxWMFRPSSJ9.eyJhdWQiOiJhcGk6Ly8yOWZhMzlkNC1kZTU3LTQwMDktYTQ2YS1jNTYxZmEwNDg1NjIiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC81MjY5YjAyMS01MzNlLTQ3MDItYjlkOS03MmFjYmM4NTJjOTcvIiwiaWF0IjoxNjcxMDQ3MDg5LCJuYmYiOjE2NzEwNDcwODksImV4cCI6MTY3MTA1MTQ2NCwiYWNyIjoiMSIsImFpbyI6IkFWUUFxLzhUQUFBQWFMY3czQm82YThySThSUUlQK01tS05GTWY4dnI2TGRiRDluRW1ibnRkMHBQTWtHVXo0eThBWW1RVmk5TTlFK2dzQzc4T2JuOXZIWFR3Uy9iNnU0TmNRZWQ0WE81dWV0bmtzQlQ0c0JtT044PSIsImFtciI6WyJwd2QiLCJtZmEiXSwiYXBwaWQiOiIyOWZhMzlkNC1kZTU3LTQwMDktYTQ2YS1jNTYxZmEwNDg1NjIiLCJhcHBpZGFjciI6IjAiLCJmYW1pbHlfbmFtZSI6Ikdyb3ZlcyIsImdpdmVuX25hbWUiOiJCcmVudCIsImdyb3VwcyI6WyJjZWFlNTA1Yy0zOTk4LTQyM2QtOTgwYS1mZjExN2QzZjVkMTQiLCIyZWVjODA4Ny1kZjZiLTRjMDEtOTcyNS0zZTMzZDAwMDA1NTciXSwiaXBhZGRyIjoiNjQuMTg0LjM2LjIzOSIsIm5hbWUiOiJCcmVudCBHcm92ZXMiLCJvaWQiOiI5YWNjZmE4OS05ODcyLTRiNjYtOWQ3MC1iNzVmMjM0MmYzYmEiLCJyaCI6IjAuQVh3QUliQnBVajVUQWtlNTJYS3N2SVVzbDlRNS1pbFgzZ2xBcEdyRllmb0VoV0s3QUxJLiIsInNjcCI6IlVzZXIuSW5mbyIsInN1YiI6ImlVOUR1cXFQTmpfcHYtWDA5UDV5R19oNE1oeW9sSFl3Rk5JaUcyLXRYcW8iLCJ0aWQiOiI1MjY5YjAyMS01MzNlLTQ3MDItYjlkOS03MmFjYmM4NTJjOTciLCJ1bmlxdWVfbmFtZSI6ImJyZW50Z3JvdmVzQDFoa3Q1dC5vbm1pY3Jvc29mdC5jb20iLCJ1cG4iOiJicmVudGdyb3Zlc0AxaGt0NXQub25taWNyb3NvZnQuY29tIiwidXRpIjoiRzJqd0FaNjl6a210bnlmZURVa2RBZyIsInZlciI6IjEuMCJ9.JpaGCvYIacYmvgrkSLEvCHcAitMLahqGPSzdUdBrwMeqpTJsE2btIOITIqTpWxF6WAf5scmEhT6FHJG5HsHwi6XtuEfKzi7HDqyIEgHk0odz5GPlEqySMHIDXUdrXP7ZMwjClz9B_MSrLROD3vCAaY4U1Xfm5rP_T39OHNc-Upguqf61o233w3qrVF4eCkd-AY8r_JA6RyJEwmYMqkJI0Kk5yO8HxDhOeXjYj3jg6RMUkkDVrMo0fERTeAI366F-JY3Ck8tkHIJu0T-Ja07zThpxN-PLtUjod6-mBzgQKWSIGNnklDJWDJjVlWOe4XnOkXLQs9iEYM00kOX3sUHdZA"}%

use jwt.io to decode the access token

https://learn.microsoft.com/en-us/graph/auth-v2-user
To use Microsoft Graph to read and write resources on behalf of a user, your app must get an access token from the Microsoft identity platform and attach the token to requests it sends to Microsoft Graph. T

Microsoft Graph also exposes the following well-defined OIDC scopes: openid, email, profile, and offline_access. The address and phone OIDC scopes aren't supported. For more information about each OIDC scope, see Permissions and consent.

name: AzureTokenTest
Client Id: 29fa39d4-de57-4009-a46a-c561fa048562
Tenant Id: 5269b021-533e-4702-b9d9-72acbc852c97


Replace:

<tenant-id> with the registered application’s tenant ID.
<client-id> with the registered application’s client ID.
<redirect-uri> with the registered application’s redirect URI. This URI must be in URL-encoded (percent-encoded) format. For example, http://localhost is http%3A%2F%2Flocalhost.
<state> with a random number or some encoded information. To help check for the integrity of information exchange, this state value should match the one that is in the returned URL later in this procedure.
api://29fa39d4-de57-4009-a46a-c561fa048562/User.Info
api%3A%2F%2F29fa39d4-de57-4009-a46a-c561fa048562%2FUser.Info

# use azure example to get a token
https://learn.microsoft.com/en-us/azure/databricks/dev-tools/api/latest/aad/app-aad-token
https://learn.microsoft.com/en-us/azure/active-directory/develop/tutorial-v2-javascript-auth-code
https://learn.microsoft.com/en-us/azure/active-directory/develop/tutorial-v2-javascript-auth-code
https://stackoverflow.com/questions/54868974/getting-security-groups-in-jwt-access-token
this article has a sample using postman.
make roles in app and assign users to roles instead of groups
MSAL replaces the Azure Active Directory Authentication Library (ADAL). 

https://jwt.io/#debugger-io